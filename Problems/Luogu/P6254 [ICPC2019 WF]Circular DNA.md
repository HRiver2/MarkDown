# P6254 [ICPC2019 WF]Circular DNA

校内 ICPC 模拟赛考到了此题，考完后发现考场代码喜提本体最优解 (虽然本来就没几个提交)。看了几篇题解，很多人都是用 `<set>` 设计的 $O(nlogn)$ 的算法，这里就介绍一个 $O(n)$ 的算法。

## 题目

这个题面不是很好懂，因为不明确 $s$，$e$ 后面数字的意思。这个数字是基因的编号，编号相同的基因是同种基因，可以认为每种基因都是独立的，$s1$，$e1$ 之间就算有再多其它种类的基因也不影响 $s1$ 和 $e1$ 的匹配。

注意断开的位置的意思是在第 $p$ 个基因前面切割。

## 真核生物

众所周知，原核生物的 DNA 是环状的，但是显然环状 DNA 比真核生物的链状 DNA 复杂，所以先考虑链状 DNA 的完美匹配种数。

将 $s$ 看出上括号，权值为 $1$，$e$ 看成下括号，权值为 $-1$，这就是一个括号匹配问题。将同种基因求权值的前缀和。由于每个编号的基因互不影响，所以不同编号基因的前缀和分别记录。

对于权值总和不等于 $0$ 的编号，无论怎么切都切不出完美匹配的情况。对于总和等于 $0$ 的编号，至少有一种切法可以使它完美匹配。

一个编号的基因是完美匹配的条件有两个，一个是总和等于零，另一个是任何时候前缀和大于等于 $0$，只要维护这个编号的前缀和的最小值即可。

所以对于真核生物，只要扫一遍 DNA 链，过程中统计权值总和和前缀和最小值，最后枚举所有编号，统计满足上面两个条件的编号数量即可。时间复杂度 $O(n)$。

## $O(n^2)$

断环为链，将环断成链后复制一份接在原来的链后面。在外层循环枚举断点，对于每个断点 $i$, 都有 $[i, i + n - 1]$ 是以 $i$ 为断点切开的 DNA 链。每个断点跑一边链式 DNA 的算法即可，复杂度 $O(n^2)$

## 递推

考虑断点向右移动
