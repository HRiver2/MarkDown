# CF793F Julia the Snail

## 题意

一个坐标轴上，有若干线段，可以从每条线段的左端走到线段右端，也可以在坐标轴上沿负方向移动。保证每条线段右端点互不相同。

每次询问给一个区间 $[L, R]$，求以 $L$ 为起点，全程不离开区间 $[L, R]$ 所能到达的最右位置。

坐标轴长度 $n$，线段数 $m$，询问数 $q$ 均满足 $\leq 10^5$。

## 分析

因为线段的右端点互不相同，所以可以用一个数组 $From_i$ 存储点 $i$ 做右端点时，对应线段的左端点。

## 暴力

询问 $[L, R]$ 时，维护一个以 $L$ 为左端点的 “Available 区间” $[L, i]$，表示当前这个区间内的所有点都能到达。一开始，Available 区间是 $[L, L]$。

从 $L + 1$ 到 $R$ 枚举指针 $j$，当 $From_j \in [L, i]$ 时， 将 $i$ 变成 $j$，继续上面的操作。最终，当 $j$ 枚举到 $R$ 时，这时的 $i$ 就是本次询问的答案。

为什么这样维护 Available 序列是正确的？当 $From_j \in [L, i]$ 时，可以从 Available 区间中的某个点走到 $j$。而从 $j$ 又可以合法地走到 $i$ 和路上的所有点。

## 分块

对坐标分块，设块长 $BlockLen$, 块数 $BlockNum$。

新建一个数组 $f_{i, j}$，表示以 $i$ 为起点，以第 $j$ 块结尾 ($jBlockLen$) 为终点的查询结果。

这样每次查询时，可以 $O(1)$ 得到 $j = kBlockLen$ 时的 Available 区间为 $[L, f_{L, kBlockLen}]$。$k$ 的选取满足 $kBlockLen < R\leq (k + 1)BlockLen$ 只需要 $O(BlockLen)$ 即可。询问总复杂度 $O(qBlockLen)$